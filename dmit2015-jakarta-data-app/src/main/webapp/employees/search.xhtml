<!-- This is a JSF composition page that extends the layout template -->
<ui:composition
        template="/WEB-INF/faces-templates/layout.xhtml"
        xmlns:ui="jakarta.faces.facelets"
        xmlns:h="jakarta.faces.html"
        xmlns:f="jakarta.faces.core"
        xmlns:p="primefaces"
        xmlns:o="http://omnifaces.org/ui">

    <!-- Page metadata for title, description, and keywords -->
    <ui:param name="title" value="Emplyoee Search"/>

    <!-- === Main Content Section === -->
    <!-- Defines the primary content area rendered in the layout's <ui:insert name="maincontent"> -->
    <ui:define name="maincontent">
        <div class="card">
            <h1 role="heading" aria-level="1">Employee Search</h1>

            <h:form id="form" role="form">

                <p:panel id="formPanel" header="Form Panel" role="region" aria-label="Form Input Panel">
                    <div class="ui-fluid">
                        <div class="field">
                            <p:outputLabel for="@next">Department Name</p:outputLabel>
<p:autoComplete id="departmentSelect"
                value="#{employeeQueryView.selectedDepartment}"
                completeMethod="#{employeeQueryView.completeDepartment}"
                var="dept" itemLabel="#{dept.departmentName}" itemValue="#{dept}"
                converter="#{departmentConverter}"
                forceSelection="true"
                scrollHeight="350"
                />
                        </div>


                        <!-- Buttons for form submission and clearing -->
                        <div class="formgroup-inline">
                            <div class="field">
                                <p:commandButton value="Submit"
                                                 action="#{employeeQueryView.onSubmit}"
                                                 update=":messages :growl @form dataTableForm:dataTable"/>
                            </div>
                            <div class="field">
                                <p:commandButton value="Clear"
                                                 action="#{employeeQueryView.onClear}"
                                                 update="@form :outputPanel"
                                                 process="@this"
                                                 styleClass="ui-button-secondary"/>
                            </div>
                        </div>

                    </div>
                </p:panel>
            </h:form>

            <!-- === Data Table for Displaying Records === -->
            <!-- Ensure rowKey references a unique property in your data model -->

            <h:form id="dataTableForm">
                <div class="card">
                    <p:dataTable id="dataTable"
                                 value="#{employeeQueryView.queryResults}"
                                 var="it"
                                 reflow="true"
                                 rowKey="#{it.id}"
                                 paginator="true" rows="10"
                                 role="grid" aria-label="Data Table">

                        <p:column headerText="Name">
                            <h:outputText value="#{it.fullName}" />
                        </p:column>

                        <p:column headerText="Hire Date">
                            <h:outputText value="#{it.hireDate}">
                                <f:convertDateTime type="localDate" pattern="MM/dd/yyyy"/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Salary">
                            <h:outputText value="#{it.salary}">
                                <f:convertNumber type="currency" locale="en_CA"/>
                            </h:outputText>
                        </p:column>

                    </p:dataTable>

                </div>
            </h:form>

        </div>
    </ui:define>

</ui:composition>